RewriteEngine On

# Custom 404 Error Page
ErrorDocument 404 /404.html

# Redirect .html URLs to extensionless versions
RewriteCond %{THE_REQUEST} ^GET\ /[^?\s]+\.html
RewriteRule ^(.*)\.html$ /$1 [R=301,L]

# Remove trailing slash if corresponding .html file exists
RewriteCond %{REQUEST_URI} !^/$
RewriteCond %{REQUEST_URI} ^(.+)/$
RewriteCond %{DOCUMENT_ROOT}%1.html -f
RewriteRule ^(.+)/$ /$1 [R=301,L]

# Remove .html extension from URLs
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^(.*)$ $1.html [L]

# Security Headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

# Enable GZIP compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser Caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/html "access plus 1 day"
</IfModule>

# Prevent directory browsing
Options -Indexes

# ==================== API DATA PROTECTION ====================
# Deny direct access to data files in api/data directory
<IfModule mod_rewrite.c>
    RewriteRule ^api/data/.*$ - [F,L]
</IfModule>

# Block access to sensitive file types
<FilesMatch "\.(json|log|sql|bak|env|ini)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Protect specific data directory (fallback for older Apache)
<Directory "api/data">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</Directory>
